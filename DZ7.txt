Урок 7. Видеоурок. Сложные запросы
Коллеги, обратите пожалуйста внимание что данные задания нужно решать с использованием JOIN!

Тема “Сложные запросы”

1.Составьте список пользователей users, которые осуществили хотя бы один заказ orders в интернет магазине.
SELECT u.name
FROM users u
  INNER JOIN orders o 
    ON (o.user_id = u.id)
GROUP BY u.name
HAVING COUNT(o.id) > 0;

2.Выведите список товаров products и разделов catalogs, который соответствует товару.

SELECT p.name, c.name
FROM products p
  INNER JOIN catalogs c 
    ON (p.catalog_id = c.id)
GROUP BY p.id;

3.(по желанию) Пусть имеется таблица рейсов flights (id, from, to) и таблица городов cities (label, name). Поля from, to и label содержат английские названия городов, поле name — русское. 
Выведите список рейсов flights с русскими названиями городов.

подготовка -

DROP TABLE IF EXISTS flights;
CREATE TABLE flights (
  id SERIAL PRIMARY KEY,
  `from` VARCHAR(255) NOT NULL COMMENT 'откуда',
  `to` VARCHAR(255) NOT NULL COMMENT 'куда'
);

DROP TABLE IF EXISTS cities;
CREATE TABLE cities (
  label VARCHAR(255) PRIMARY KEY COMMENT 'id',
  name VARCHAR(255) COMMENT 'Руссское наименование города'
);


INSERT INTO flights (`from`, `to`) VALUES
  ('Moscow', 'Omsk'),
  ('Novgorod', 'Kazan'),
  ('Irkutsk', 'Moscow'),
  ('Omsk', 'Irkutsk'),
  ('Moscow', 'Kazan');
 
INSERT INTO cities (label, name) VALUES
  ('Moscow', 'Москва'),
  ('Novgorod', 'Новгород'),
  ('Irkutsk', 'Иркутск'),
  ('Omsk', 'Омск'),
  ('Kazan', 'Казань');


-- ALTER TABLE flights
--   ADD CONSTRAINT flights_from_label
--     FOREIGN KEY (`from`) REFERENCES cities(label),
--   ADD CONSTRAINT flights_to_label
--     FOREIGN KEY (`to`) REFERENCES cities(label)
--       ON DELETE CASCADE;
     
     -- Решение:
1/ 
SELECT
  flights.id, 
  c_from.name AS `from`, 
  c_to.name AS `to`
FROM flights  
  JOIN cities AS c_from
    ON flights.`from` = c_from.label
  JOIN cities AS c_to


2/ Без Join

SELECT
  id AS f_id,
  (SELECT name FROM cities WHERE label = `from`) AS `from`,
  (SELECT name FROM cities WHERE label = `to`) AS `to`
FROM flights
ORDER BY f_id;