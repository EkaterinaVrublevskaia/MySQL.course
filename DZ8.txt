Урок 8. Вебинар. Сложные запросы
Переписать запросы, заданые к ДЗ урока 6, с использованием JOIN.

3. Определить кто больше поставил лайков (всего) - мужчины или женщины?


SELECT profiles.gender AS gender,
  COUNT(likes.id) AS like_gender
  FROM likes 
    JOIN profiles 
      ON likes.user_id = profiles.user_id 
  GROUP BY gender
  ORDER BY like_gender DESC
  LIMIT 1;




4. Вывести для каждого пользователя количество созданных сообщений, постов, загруженных медиафайлов и поставленных лайков.

 SELECT 
  users.first_name,
  users.last_name, 
  COUNT(messages.id) AS total_messages,
  COUNT(likes.id) AS total_likes,
  COUNT(posts.id) AS total_posts,
  COUNT(media.id) AS total_media
  FROM users 
    LEFT JOIN messages 
      ON users.id = messages.from_user_id
    LEFT JOIN likes 
      ON users.id = likes.user_id
    LEFT JOIN posts 
      ON users.id = posts.user_id
    LEFT JOIN media 
      ON users.id = media.user_id
    GROUP BY users.id;
    


5. (по желанию) Подсчитать количество лайков которые получили 10 самых молодых пользователей.
-- Не верный результат с DESC

SELECT SUM(res) AS total_young
  FROM 
  (SELECT COUNT(likes.id) AS res 
    FROM profiles 
      LEFT JOIN likes
        ON likes.target_id = profiles.user_id
          AND likes.target_type = 'users'
    GROUP BY profiles.user_id
    ORDER BY  TIMESTAMPDIFF(YEAR, birthday, NOW()) DESC
    LIMIT 10) AS young;

--Без DESC результат верный.

SELECT SUM(res) AS total_young
  FROM 
  (SELECT COUNT(likes.id) AS res 
    FROM profiles 
      LEFT JOIN likes
        ON likes.target_id = profiles.user_id
          AND likes.target_type = 'users'
    GROUP BY profiles.user_id
    ORDER BY  TIMESTAMPDIFF(YEAR, birthday, NOW())
    LIMIT 10) AS young;